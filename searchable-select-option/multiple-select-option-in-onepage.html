<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Country Dropdown</title>
    <style>
        .custom-select {
            position: relative;
            width: 300px;
            margin: 20px;
        }

        .select-selected {
            background-color: #fff;
            padding: 8px 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .select-selected:after {
            content: 'â–¼';
            position: absolute;
            right: 16px;
            font-size: 12px;
            color: #999;
        }

        .select-dropdown {
            position: absolute;
            background-color: #fff;
            border: 1px solid #333;
            border-top: none;
            border-radius: 0 0 8px 8px;
            z-index: 1000;
            width: 100%;
            display: none;
            margin-top: -1px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .select-dropdown.show {
            display: block;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px;
            border: none;
            border-bottom: 1px solid #333;
            background-color: #fff;
            color: #333;
            outline: none;
            font-size: 14px;
        }

        .select-items {
            max-height: 200px;
            overflow-y: auto;
        }

        .country-option {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            transition: background-color 0.2s;
        }

        .country-option:hover,
        .country-option.highlighted {
            background-color: #f0f0f0;
        }

        .flag-icon {
            width: 24px;
            height: 18px;
            object-fit: cover;
            border-radius: 2px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <h1>Test Country Dropdown</h1>
    
    <div>
        <label>First Country:</label>
        <div class="custom-select">
            <div class="select-selected">
                <span>Select a country</span>
            </div>
            <div class="select-dropdown">
                <input type="text" placeholder="Search country..." class="search-input">
                <div class="select-items"></div>
            </div>
        </div>
        <input type="hidden" name="country1" class="country-input">
    </div>

    <div>
        <label>Second Country:</label>
        <div class="custom-select">
            <div class="select-selected">
                <span>Select a country</span>
            </div>
            <div class="select-dropdown">
                <input type="text" placeholder="Search country..." class="search-input">
                <div class="select-items"></div>
            </div>
        </div>
        <input type="hidden" name="country2" class="country-input">
    </div>

    <script>
        // Test countries data
        window.countriesData = [
            { name: "Bangladesh", callingCode: "+880", flag: "https://flagcdn.com/bd.svg", emoji: "ðŸ‡§ðŸ‡©" },
            { name: "Pakistan", callingCode: "+92", flag: "https://flagcdn.com/pk.svg", emoji: "ðŸ‡µðŸ‡°" },
            { name: "India", callingCode: "+91", flag: "https://flagcdn.com/in.svg", emoji: "ðŸ‡®ðŸ‡³" },
            { name: "United Kingdom", callingCode: "+44", flag: "https://flagcdn.com/gb.svg", emoji: "ðŸ‡¬ðŸ‡§" },
            { name: "United States", callingCode: "+1", flag: "https://flagcdn.com/us.svg", emoji: "ðŸ‡ºðŸ‡¸" }
        ];

        // Initialize country dropdown when DOM is ready
        function initializeCountryDropdown() {
            console.log('Initializing country dropdowns...');
            
            // Find all country dropdowns on the page
            const countryDropdowns = document.querySelectorAll('.custom-select');
            
            console.log('Found country dropdowns:', countryDropdowns.length);

            if (countryDropdowns.length === 0) {
                console.log('No country dropdowns found on this page');
                return;
            }

            // Initialize each dropdown
            countryDropdowns.forEach((dropdown, index) => {
                initializeSingleDropdown(dropdown, index);
            });
        }

        function initializeSingleDropdown(dropdownContainer, index) {
            console.log(`Initializing dropdown ${index}:`, dropdownContainer);

            const selectSelected = dropdownContainer.querySelector('.select-selected');
            const selectDropdown = dropdownContainer.querySelector('.select-dropdown');
            const selectItems = dropdownContainer.querySelector('.select-items');
            const searchInput = dropdownContainer.querySelector('.search-input');
            
            // Look for hidden input in the parent container
            const parentContainer = dropdownContainer.parentElement;
            const countryInput = parentContainer ? parentContainer.querySelector('input[type="hidden"]') : null;

            console.log(`Dropdown ${index} elements:`, {
                selectSelected: !!selectSelected,
                selectDropdown: !!selectDropdown,
                selectItems: !!selectItems,
                searchInput: !!searchInput,
                countryInput: !!countryInput,
                parentContainer: !!parentContainer
            });

            // Check if all required elements exist
            if (!selectSelected || !selectDropdown || !selectItems || !searchInput || !countryInput) {
                console.warn(`Country dropdown ${index} missing required elements:`, dropdownContainer);
                return;
            }

            let countriesData = [];

            // Use test data
            if (window.countriesData && Array.isArray(window.countriesData) && window.countriesData.length > 0) {
                console.log(`Using test countries data for dropdown ${index}:`, window.countriesData.length, 'countries');
                countriesData = window.countriesData;
                renderCountries(countriesData);
            }

            // Function to render countries
            function renderCountries(countries) {
                if (!selectItems) return;

                selectItems.innerHTML = '';

                if (countries.length === 0) {
                    selectItems.innerHTML = '<div class="country-option" style="color: #999;">No countries found</div>';
                    return;
                }

                countries.forEach((country) => {
                    const div = document.createElement('div');
                    div.className = 'country-option';
                    div.innerHTML = `
                        <img src="${country.flag}" class="flag-icon" alt="${country.name}" onerror="this.style.display='none'">
                        <span>${country.name}</span>
                    `;
                    div.onclick = () => {
                        selectSelected.innerHTML = `
                            <img src="${country.flag}" class="flag-icon" alt="${country.name}" onerror="this.style.display='none'">
                            <span>${country.name}</span>
                        `;
                        countryInput.value = country.name;
                        selectDropdown.classList.remove('show');
                        searchInput.value = '';
                        renderCountries(countriesData);
                    };
                    selectItems.appendChild(div);
                });
            }

            // Search/Filter functionality
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredCountries = countriesData.filter(
                    (country) =>
                        country.name.toLowerCase().includes(searchTerm) || country.callingCode.includes(searchTerm)
                );
                renderCountries(filteredCountries);
            });

            // Toggle dropdown
            selectSelected.addEventListener('click', () => {
                selectDropdown.classList.toggle('show');
                if (selectDropdown.classList.contains('show')) {
                    searchInput.focus();
                }
            });

            // Prevent closing when clicking inside dropdown
            selectDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Close when clicking outside
            document.addEventListener('click', (e) => {
                if (!dropdownContainer.contains(e.target)) {
                    selectDropdown.classList.remove('show');
                    searchInput.value = '';
                    if (countriesData.length > 0) {
                        renderCountries(countriesData);
                    }
                }
            });
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            initializeCountryDropdown();
        });
    </script>
</body>
</html>